{% extends 'base.html' %}

{% block title %}Users and Locker Metrics{% endblock %}

{% block content %}
<div class="container mt-5">
    <!-- Active Users Section -->
    <h1 class="text-center mb-4"> Active Users <i class="bi bi-people-fill"></i> </h1>

    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>User</th>
                <th>Email</th>
                <th>More</th>
            </tr>
        </thead>
        <tbody>
            {% for usuario in usuarios %}
                <tr>
                    <td>{{ usuario.name }}</td>
                    <td>{{ usuario.email }}</td>
                    <td>
                        <div class="dropdown">
                            <button class="btn btn-dark" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="bi bi-three-dots"></i>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a href="{% url 'usuario_update' usuario.id %}" class="dropdown-item">Edit</a></li>
                            </ul>
                        </div>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="text-center">
        <a href="{% url 'usuario_create' %}" class="btn btn-dark mt-3">
            <i class="bi bi-person-add fs-5"></i> New User
        </a>
    </div>

    <!-- Locker Metrics Section -->
    <h1 class="text-center mt-5 mb-4"> Locker Metrics <i class="bi bi-bar-chart-fill"></i> </h1>

    <!-- Similitud entre contraseñas -->
    <div class="card mb-4">
        <div class="card-header bg-dark text-white">
            Similitud entre Contraseñas
        </div>
        <div class="card-body">
            <p class="card-text">Nivel de similitud entre contraseñas: <span class="fw-bold">{{ password_similarity }}</span></p>
        </div>
    </div>

    <!-- Aperturas totales de casilleros por hora -->
    <div class="card mb-4">
        <div class="card-header bg-dark text-white">
            Aperturas Totales de Casilleros en el Día (Por Hora)
        </div>
        <div class="card-body">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Hora</th>
                        <th>Aperturas</th>
                    </tr>
                </thead>
                <tbody>
                    {% for hour, count in daily_openings %}
                    <tr>
                        <td>{{ hour }}</td>
                        <td>{{ count }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Aperturas totales de casilleros por mes -->
    <div class="card mb-4">
        <div class="card-header bg-dark text-white">
            Aperturas Totales de Casilleros (Por Mes)
        </div>
        <div class="card-body">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Mes</th>
                        <th>Aperturas</th>
                    </tr>
                </thead>
                <tbody>
                    {% for month, count in monthly_openings %}
                    <tr>
                        <td>{{ month }}</td>
                        <td>{{ count }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Tiempo medio de casilleros abiertos -->
    <div class="card mb-4">
        <div class="card-header bg-dark text-white">
            Tiempo Medio que un Casillero Permanece Abierto
        </div>
        <div class="card-body">
            <p class="card-text">Tiempo promedio de apertura: <span class="fw-bold">{{ average_open_time }}</span></p>
        </div>
    </div>
</div>
{% endblock %}
